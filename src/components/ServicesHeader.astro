---
import ThemeToggle from "./ThemeToggle.astro";
import type { BrandConfig } from "../brands";

const { brand, inverse = false } = Astro.props as {
  brand: BrandConfig;
  inverse?: boolean;
};

const nameParts = brand.name.split(" ");
const firstName = nameParts[0];
const secondName = nameParts.length > 1 ? nameParts[1] : "";
---

<div
  class="absolute top-0 left-0 right-0 z-50 flex justify-center md:pt-6 md:px-4 pointer-events-none"
>
  <header
    id="main-nav-services"
    class={`pointer-events-auto relative tracking-tight flex items-center justify-between w-full transition-all duration-500
    /* Mobile Styles */
    px-6 py-4 bg-black/60 backdrop-blur-md border-b border-white/10
    /* Desktop Styles */
    md:rounded-full md:px-6 md:py-3 md:shadow-[0_8px_30px_rgb(0,0,0,0.3)] md:border md:border-white/10 md:max-w-6xl
    text-white 
    md:bg-black/60 md:backdrop-blur-md transition-colors duration-300`}
  >
    <!-- Logo -->
    <a
      href={`/`}
      class="group flex items-center gap-2 mr-auto md:mr-8 shrink-0"
    >
      {/* Force White Logo for Dark Header */}
      {brand.logoPathWhite ? (
        <img
          src={brand.logoPathWhite}
          alt={brand.name}
          class="h-8 w-auto object-contain block"
        />
      ) : (
        <span
          class="text-xl font-bold tracking-tighter uppercase text-white group-hover:text-queens-secondary transition-colors duration-300"
        >
          {firstName}{" "}
          <span
            class="text-queens-secondary group-hover:text-white transition-colors duration-300"
          >
            {secondName}
          </span>
        </span>
      )}
    </a>

    <!-- Desktop Navigation -->
    <nav class="hidden md:flex items-center gap-1">
      <a
        href={`/`}
        data-astro-prefetch="hover"
        class="text-sm font-medium text-white/90 hover:text-white px-4 py-2 rounded-full hover:bg-white/10 transition-all border border-transparent hover:border-white/20"
        >Home</a
      >
      <a
        href={`/services`}
        data-astro-prefetch="hover"
        class="text-sm font-medium text-white/90 hover:text-white px-4 py-2 rounded-full hover:bg-white/10 transition-all border border-transparent hover:border-white/20"
        >Services</a
      >
      <a
        href={`/buy-new-tires`}
        data-astro-reload
        class="text-sm font-medium text-white/90 hover:text-white px-4 py-2 rounded-full hover:bg-white/10 transition-all border border-transparent hover:border-white/20"
        >New Tires</a
      >
      <a
        href={`/deals`}
        data-astro-prefetch="hover"
        class="text-sm font-medium text-white/90 hover:text-white px-4 py-2 rounded-full hover:bg-white/10 transition-all border border-transparent hover:border-white/20"
        >Deals</a
      >
      <a
        href={`/contact`}
        data-astro-prefetch="hover"
        class="text-sm font-medium text-white/90 hover:text-white px-4 py-2 rounded-full hover:bg-white/10 transition-all border border-transparent hover:border-white/20"
        >Contact</a
      >
    </nav>

    <!-- Right Side Actions -->
    <div class="flex items-center gap-3 ml-auto md:ml-0 pl-0 md:pl-0">
      <ThemeToggle inverse={true} />

      <a
        href={`/request-an-appointment`}
        class="hidden md:inline-flex items-center justify-center bg-queens-primary hover:bg-queens-secondary text-white text-sm font-bold px-6 py-2.5 rounded-full transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5 border border-white/20"
      >
        Book Appointment
      </a>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button-services"
        class="md:hidden p-1 text-white hover:text-queens-secondary"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-7 h-7"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
        </svg>
      </button>
    </div>
  </header>
</div>

<!-- Mobile Menu Overlay -->
<div id="mobile-menu-services" class="fixed inset-0 z-[100] hidden md:hidden">
  <!-- Backdrop -->
  <div
    id="mobile-menu-backdrop-services"
    class="absolute inset-0 bg-black/20 backdrop-blur-sm"
  >
  </div>

  <!-- Menu Panel -->
  <div
    class="absolute top-4 right-4 left-4 bg-white dark:bg-queens-dark rounded-3xl shadow-2xl overflow-hidden animate-in fade-in slide-in-from-top-4 duration-200"
  >
    <div
      class="flex justify-between items-center p-6 border-b border-gray-100 dark:border-gray-800"
    >
      <span class="font-bold text-lg text-queens-primary dark:text-white"
        >Menu</span
      >
      <button
        id="mobile-menu-close-services"
        class="p-2 -mr-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-6 h-6"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <nav class="p-4 flex flex-col space-y-2">
      <a
        href={`/`}
        class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-white/10 text-gray-700 dark:text-gray-300 font-medium"
      >
        Home
      </a>
      <a
        href={`/services`}
        class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-white/10 text-gray-700 dark:text-gray-300 font-medium"
      >
        Services
      </a>
      <a
        href={`/buy-new-tires`}
        data-astro-reload
        class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-white/10 text-gray-700 dark:text-gray-300 font-medium"
      >
        New Tires
      </a>
      <a
        href={`/deals`}
        class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-white/10 text-gray-700 dark:text-gray-300 font-medium"
      >
        Deals
      </a>
      <a
        href={`/contact`}
        class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-white/10 text-gray-700 dark:text-gray-300 font-medium"
      >
        Contact
      </a>
    </nav>

    <div class="p-6 border-t border-gray-100 dark:border-gray-800">
      <a
        href={`/request-an-appointment`}
        class="w-full flex items-center justify-center bg-queens-primary hover:bg-queens-secondary text-white font-bold py-3 rounded-xl transition-colors"
      >
        Book Appointment
      </a>
    </div>
  </div>
</div>

<script>
  function setupHeaderServices() {
    const nav = document.getElementById("main-nav-services");
    const mobileMenuButton = document.getElementById("mobile-menu-button-services");
    const mobileMenu = document.getElementById("mobile-menu-services");
    const mobileMenuClose = document.getElementById("mobile-menu-close-services");
    const mobileMenuBackdrop = document.getElementById("mobile-menu-backdrop-services");

    if (!nav) return;

    // Trigger animation on load (Desktop only - check if on desktop)
    // Phase 1: Nice and slow zoom in (0.8 â†’ 1.0), then Phase 2: Elastic bounce effect
    const isDesktop = window.matchMedia("(min-width: 768px)").matches;
    
    if (isDesktop) {
      // CSS already sets initial scale(0.8), now animate to scale(1)
      // Use RAF to ensure we're in the next paint cycle
      requestAnimationFrame(() => {
        // Phase 1: Nice and slow zoom in from 0.8 to 1.0
        nav.style.transition = "transform 800ms ease-out";
        nav.style.transform = "scale(1)";
        
        // Phase 2: After zoom completes, trigger elastic bounce
        setTimeout(() => {
          nav.style.transition = "none";
          nav.classList.add("animate-elastic-bounce");
          
          // Clean up after animation
          setTimeout(() => {
            nav.classList.remove("animate-elastic-bounce");
            nav.style.transition = "";
          }, 500);
        }, 800);
      });
    }
    // Mobile: no animation needed, navbar stays at default scale

    if (!mobileMenuButton || !mobileMenu) return;

    const openMobileMenu = () => {
      mobileMenu.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    };

    const closeMobileMenu = () => {
      mobileMenu.classList.add("hidden");
      document.body.style.overflow = "";
    };

    mobileMenuButton.addEventListener("click", openMobileMenu);
    mobileMenuClose?.addEventListener("click", closeMobileMenu);
    mobileMenuBackdrop?.addEventListener("click", closeMobileMenu);

    // Close menu when clicking a nav link
    mobileMenu.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", closeMobileMenu);
    });

    // Clean up on page swap
    document.addEventListener(
      "astro:before-swap",
      () => {
        closeMobileMenu();
      },
      { once: true },
    );
  }

  // Run on initial load
  setupHeaderServices();

  // Run on view transitions
  document.addEventListener("astro:page-load", setupHeaderServices);
</script>

<style>
  /* Desktop: Start navbar at 80% scale - JS will animate to 100% */
  @media (min-width: 768px) {
    #main-nav-services {
      transform: scale(0.8);
    }
  }
</style>
