---
import { mobileTiresBrand } from "../brands";

interface Props {
    webhookUrl?: string;
    promoCode?: string;
    fullDark?: boolean;
    thankYouUrl?: string;
    step1TitlePrefix?: string;
    step1TitleHighlight?: string;
    step1Description?: string;
    step2Description?: string;
    step3Description?: string;
}

const {
    webhookUrl = "https://n8n.queensautoservices.com/webhook-test/6e74632a-1fc8-4ff8-9465-ae6ed1c0c4ae",
    promoCode = "standard_booking",
    fullDark = false,
    thankYouUrl = "/thank-you",
    step1TitlePrefix = "",
    step1TitleHighlight = "Secure Your Spot",
    step1Description = "Step 1 of 3 — Your contact and vehicle details.",
    step2Description = "Step 2 of 3 — What service does your vehicle need?",
    step3Description = "Step 3 of 3 — When can you bring it in?",
} = Astro.props;
---

<!-- Custom Form CSS -->
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style is:inline>
    .cta-button {
        background: linear-gradient(to right, #22d3ee, #3b82f6 60%);
        transition:
            transform 0.2s ease,
            box-shadow 0.2s ease;
    }
    .cta-button:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px -5px rgba(34, 197, 222, 0.3);
    }
    .form-step.hidden {
        display: none;
    }
    .calendar-day {
        width: 2.5rem;
        height: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 9999px;
        cursor: pointer;
        font-size: 0.875rem;
        color: #1f2937; /* gray-800 for light mode */
        transition:
            background-color 0.2s,
            color 0.2s;
    }
    .dark .calendar-day {
        color: #e2e8f0; /* slate-200 for dark mode */
    }
    .calendar-day:hover:not(.disabled):not(.selected) {
        background-color: #e5e7eb; /* gray-200 for light mode */
    }
    .dark .calendar-day:hover:not(.disabled):not(.selected) {
        background-color: #334155; /* slate-700 for dark mode */
    }
    .calendar-day.selected {
        background-color: #0a79c8;
        color: white;
        font-weight: bold;
    }
    .calendar-day.today {
        color: #0a79c8;
        background-color: rgba(10, 121, 200, 0.1);
        font-weight: bold;
    }
    .dark .calendar-day.today {
        background-color: rgba(10, 121, 200, 0.2);
    }
    .calendar-day.disabled {
        color: #9ca3af; /* gray-400 for light mode */
        cursor: not-allowed;
    }
    .calendar-day.holiday {
        text-decoration: line-through;
        opacity: 0.6;
    }
    .dark .calendar-day.disabled {
        color: #475569; /* slate-600 for dark mode */
    }
    .time-slot {
        color: #374151; /* gray-700 */
        border: 2px solid #f3f4f6; /* gray-100 */
        background-color: rgba(249, 250, 251, 0.5); /* gray-50/50 */
        border-radius: 0.75rem; /* rounded-xl */
        transition: all 0.2s ease;
    }
    .dark .time-slot {
        color: #e2e8f0; /* slate-200 */
        border-color: rgba(255, 255, 255, 0.05); /* white/5 */
        background-color: rgba(255, 255, 255, 0.05); /* white/5 */
    }
    .time-slot:hover:not(.selected) {
        background-color: rgba(10, 121, 200, 0.05);
        border-color: rgba(10, 121, 200, 0.3);
    }
    .dark .time-slot:hover:not(.selected) {
        background-color: rgba(10, 121, 200, 0.1);
        border-color: rgba(10, 121, 200, 0.4);
    }
    .time-slot.selected {
        background-color: #0a79c8;
        color: white;
        border-color: #0a79c8;
        box-shadow: 0 4px 12px rgba(10, 121, 200, 0.2);
    }

    /* Calendar weekday headers */
    #calendar-grid-header > span {
        color: #6b7280; /* gray-500 for light mode */
        font-size: 0.75rem;
        font-weight: 500;
    }
    .dark #calendar-grid-header > span {
        color: #94a3b8; /* slate-400 for dark mode */
    }

    .input-wrapper .validation-icon {
        display: none;
    }
    .input-wrapper.is-valid .icon-valid {
        display: block;
        color: #22c55e;
    }
    .input-wrapper.is-invalid .icon-invalid {
        display: block;
        color: #ef4444;
    }
    .input-field.is-valid {
        border-color: #22c55e !important;
        padding-right: 2.5rem !important;
    }
    .input-field.is-invalid {
        border-color: #ef4444 !important;
        padding-right: 2.5rem !important;
    }
    .input-field {
        transition:
            padding-right 0.2s ease-in-out,
            border-color 0.2s ease-in-out;
    }
    .input-field.is-valid:focus {
        --tw-ring-color: #22c55e;
    }
    .input-field.is-invalid:focus {
        --tw-ring-color: #ef4444;
    }

    /* Dark mode input field overrides - ensure solid colors, no gradient */
    .dark .input-field,
    .dark select {
        background-color: #1e293b !important; /* slate-800 solid */
        border-color: #475569 !important; /* slate-600 solid */
        background-image: none !important;
    }

    /* Fix for dark mode dropdown options (prevent white text on white bg) */
    .dark select option {
        background-color: #141517;
        color: white;
    }

    /* Attempt to hide scrollbar on select (browser support varies for dropdowns) */
    select {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    select::-webkit-scrollbar {
        display: none;
    }

    /* ==========================================
       ANIMATED GRADIENT SWOOSH BORDER ON FOCUS
       Creates a sweeping beam effect
       ========================================== */

    /* The swoosh border wrapper */
    .input-wrapper .relative {
        position: relative;
        z-index: 1;
    }

    /* Ensure input is above the swoosh border */
    .input-wrapper .relative .input-field {
        position: relative;
        z-index: 2;
    }

    /* Create the shimmer beam border */
    .input-wrapper .relative::before {
        content: "";
        position: absolute;
        inset: -2px;
        border-radius: 8px;
        z-index: 0;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;

        /* The shimmer gradient - 295deg diagonal, narrow beam with transparent ends */
        background: linear-gradient(
                295deg,
                transparent 0%,
                transparent 45%,
                #22d3ee 47%,
                #3b82f6 50%,
                #0a79c8 53%,
                transparent 55%,
                transparent 100%
            )
            0 0 / 300% 100% no-repeat;

        /* Mask to show only the border */
        -webkit-mask:
            linear-gradient(#0000, #0000) padding-box,
            linear-gradient(#fff, #fff) border-box;
        mask:
            linear-gradient(#0000, #0000) padding-box,
            linear-gradient(#fff, #fff) border-box;
        -webkit-mask-composite: destination-out;
        mask-composite: exclude;
        padding: 2px;
    }

    /* Show and animate the beam on focus */
    .input-wrapper .relative:focus-within::before {
        opacity: 1;
        animation: shimmer 4s ease-in-out infinite;
    }

    /* The shimmer animation - sweeps from right to left */
    @keyframes shimmer {
        0% {
            background-position: 100% 0;
        }
        50%,
        100% {
            background-position: 0% 0;
        }
    }

    /* Hide default focus ring when swoosh is active */
    .input-wrapper .relative:focus-within .input-field {
        border-color: transparent !important;
        box-shadow: none !important;
        outline: none !important;
    }

    /* Keep input background solid in dark mode */
    .dark .input-wrapper .relative:focus-within .input-field {
        background-color: #1e293b !important;
        background-image: none !important;
        color: #e2e8f0 !important;
    }

    /* Keep input background solid in light mode */
    .input-wrapper .relative:focus-within .input-field {
        background-color: #f9fafb !important;
        background-image: none !important;
        color: #1f2937 !important;
    }

    /* Dark mode override must come after */
    .dark .input-wrapper .relative:focus-within .input-field {
        background-color: #1e293b !important;
        background-image: none !important;
        color: #e2e8f0 !important;
    }

    /* Keep placeholder visible */
    .input-field:focus::placeholder {
        color: #9ca3af !important;
        opacity: 0.7;
    }

    /* Stepper Styles */
    .stepper-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 2rem;
        position: relative;
        padding: 1rem 0 2.5rem;
        margin-bottom: 1rem;
    }

    .stepper-line {
        position: absolute;
        top: 1rem;
        left: 25%;
        right: 25%;
        height: 2px;
        background: #cbd5e1; /* slate-300 - visible in light mode */
        z-index: 0;
    }

    .dark .stepper-line {
        background: rgba(255, 255, 255, 0.2);
    }

    .stepper-line-active {
        position: absolute;
        top: 1rem;
        left: 25%;
        height: 2px;
        background: #0a79c8;
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1;
    }

    .step-node {
        width: 2rem;
        height: 2rem;
        border-radius: 9999px;
        background-color: white;
        border: 2px solid #cbd5e1; /* slate-300 - visible border */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        position: relative;
        z-index: 2;
    }

    .dark .step-node {
        background-color: #1e293b; /* slate-800 */
        border-color: #475569; /* slate-600 */
    }

    .step-node.active {
        border-color: #0a79c8;
        background-color: #0a79c8;
        box-shadow: 0 0 0 4px rgba(10, 121, 200, 0.2);
    }

    .dark .step-node.active {
        box-shadow: 0 0 12px rgba(10, 121, 200, 0.5);
    }

    .step-node.completed {
        background-color: #0a79c8;
        border-color: #0a79c8;
    }

    .step-node-inner {
        width: 0.5rem;
        height: 0.5rem;
        border-radius: 9999px;
        background-color: #94a3b8; /* slate-400 - visible inner dot */
        transition: all 0.3s ease;
    }

    .dark .step-node-inner {
        background-color: #64748b; /* slate-500 */
    }

    .active .step-node-inner,
    .completed .step-node-inner {
        background-color: white;
    }

    .step-label {
        position: absolute;
        top: 2.5rem;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.75rem;
        font-weight: 600;
        color: rgba(15, 23, 42, 0.5);
        white-space: nowrap;
        transition: color 0.3s ease;
    }

    .dark .step-label {
        color: rgba(148, 163, 184, 0.7);
    }

    .active .step-label {
        color: #0a79c8;
    }

    .dark .active .step-label {
        color: #38bdf8;
    }

    .completed .step-label {
        color: #0b1121;
    }

    .dark .completed .step-label {
        color: white;
    }

    /* Service Card Icon Styling - Primary Blue */
    .service-card .service-icon-svg {
        color: #0a79c8;
        transition:
            transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1),
            color 0.3s ease;
    }

    .service-card.selected .service-icon-svg {
        transform: scale(1.2);
    }

    .dark .service-card .service-icon-svg {
        color: #0a79c8;
    }
</style>

<div
    id="book-appointment-form"
    class="py-12 px-4"
    data-webhook={webhookUrl}
    data-promo={promoCode}
    data-thankyou={thankYouUrl}
    data-step1desc={step1Description}
    data-step2desc={step2Description}
    data-step3desc={step3Description}
>
    <div id="form-container-wrapper" class="max-w-2xl mx-auto">
        <div
            class={`bg-white dark:bg-slate-800/50 border border-gray-100 dark:border-white/10 shadow-xl dark:shadow-black/20 rounded-3xl p-6 sm:p-8 md:p-12 backdrop-blur-sm transition-all duration-300 ${fullDark ? "dark" : ""}`}
        >
            <div id="form-content">
                <div class="text-center">
                    <h1
                        class="h1 font-bold tracking-tight text-gray-900 dark:text-white"
                    >
                        {step1TitlePrefix}
                        <span
                            class="bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent"
                            >{step1TitleHighlight}</span
                        >
                    </h1>

                    <!-- Progress Steps -->
                    <div class="progress-steps">
                        <div class="progress-track">
                            <div class="progress-bar" id="stepper-progress-bar">
                            </div>
                        </div>
                        <div class="steps-container">
                            <div class="step active" data-step="1">
                                <span>1</span>
                            </div>
                            <div class="step" data-step="2"><span>2</span></div>
                            <div class="step" data-step="3"><span>3</span></div>
                        </div>
                    </div>
                </div>
                <form id="booking-form" class="mt-8 relative min-h-[500px]">
                    <input type="hidden" name="utm_source" />
                    <input type="hidden" name="utm_medium" />
                    <input type="hidden" name="utm_campaign" />
                    <input type="hidden" name="utm_term" />
                    <input type="hidden" name="utm_content" />
                    <input type="hidden" name="ga_client_id" />
                    <input type="hidden" name="gclid" />
                    <input type="hidden" name="fbc" />
                    <input type="hidden" name="fbclid" />
                    <input type="hidden" name="msclkid" />
                    <input type="hidden" name="referrer" />
                    <input type="hidden" name="event_id" />
                    <div id="form-step-1" class="form-step visible">
                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="input-wrapper">
                                    <label
                                        for="first-name"
                                        class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1"
                                        data-translate-key="firstName"
                                        >First Name</label
                                    >
                                    <div class="relative mt-1">
                                        <input
                                            type="text"
                                            id="first-name"
                                            name="first-name"
                                            required
                                            placeholder="Enter first name"
                                            class="input-field block w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-300 dark:focus:ring-sky-500 focus:border-sky-300 dark:focus:border-sky-500 sm:text-sm"
                                        />
                                        <div
                                            class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
                                        >
                                            <svg
                                                class="validation-icon icon-valid h-5 w-5"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                            >
                                                <path
                                                    fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                            <svg
                                                class="validation-icon icon-invalid h-5 w-5"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                            >
                                                <path
                                                    fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div class="input-wrapper">
                                    <label
                                        for="last-name"
                                        class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1"
                                        data-translate-key="lastName"
                                        >Last Name</label
                                    >
                                    <div class="relative mt-1">
                                        <input
                                            type="text"
                                            id="last-name"
                                            name="last-name"
                                            required
                                            placeholder="Enter last name"
                                            class="input-field block w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-300 dark:focus:ring-sky-500 focus:border-sky-300 dark:focus:border-sky-500 sm:text-sm"
                                        />
                                        <div
                                            class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
                                        >
                                            <svg
                                                class="validation-icon icon-valid h-5 w-5"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                            >
                                                <path
                                                    fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                            <svg
                                                class="validation-icon icon-invalid h-5 w-5"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                            >
                                                <path
                                                    fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div class="input-wrapper">
                                    <label
                                        for="email"
                                        class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1"
                                        data-translate-key="email">Email</label
                                    >
                                    <div class="relative mt-1">
                                        <input
                                            type="email"
                                            id="email"
                                            name="email"
                                            required
                                            placeholder="you@example.com"
                                            class="input-field block w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-300 dark:focus:ring-sky-500 focus:border-sky-300 dark:focus:border-sky-500 sm:text-sm"
                                        />
                                        <div
                                            class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
                                        >
                                            <svg
                                                class="validation-icon icon-valid h-5 w-5"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                            >
                                                <path
                                                    fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                            <svg
                                                class="validation-icon icon-invalid h-5 w-5"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                            >
                                                <path
                                                    fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div class="input-wrapper">
                                    <label
                                        for="mobile-number"
                                        class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1"
                                        data-translate-key="mobileNumber"
                                        >Mobile Number</label
                                    >
                                    <div class="relative mt-1">
                                        <input
                                            type="tel"
                                            id="mobile-number"
                                            name="mobile-number"
                                            required
                                            placeholder="(###) ###-####"
                                            class="input-field block w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-300 dark:focus:ring-sky-500 focus:border-sky-300 dark:focus:border-sky-500 sm:text-sm"
                                        />
                                        <div
                                            class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
                                        >
                                            <svg
                                                class="validation-icon icon-valid h-5 w-5"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                            >
                                                <path
                                                    fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                            <svg
                                                class="validation-icon icon-invalid h-5 w-5"
                                                xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20"
                                                fill="currentColor"
                                            >
                                                <path
                                                    fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                                    clip-rule="evenodd"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="pt-2">
                                <h5
                                    class="text-xl font-bold text-gray-900 dark:text-white mb-4"
                                    data-translate-key="vehicleDetails"
                                >
                                    Vehicle Details
                                </h5>
                                <div
                                    class="grid grid-cols-1 md:grid-cols-3 gap-6"
                                >
                                    <div>
                                        <label
                                            for="vehicle-year"
                                            class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1"
                                            data-translate-key="carYear"
                                            >Year</label
                                        ><select
                                            id="vehicle-year"
                                            name="vehicle-year"
                                            required
                                            class="mt-1 block w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-sky-300 dark:focus:ring-sky-500 focus:border-sky-300 dark:focus:border-sky-500 sm:text-sm"
                                        >
                                            <option value="" disabled selected
                                                >Select Year</option
                                            >
                                        </select>
                                    </div>
                                    <div class="input-wrapper">
                                        <label
                                            for="vehicle-make"
                                            class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1"
                                            data-translate-key="carMake"
                                            >Make</label
                                        >
                                        <div class="relative mt-1">
                                            <input
                                                type="text"
                                                id="vehicle-make"
                                                name="vehicle-make"
                                                required
                                                placeholder="e.g., Ford"
                                                class="input-field block w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-300 dark:focus:ring-sky-500 focus:border-sky-300 dark:focus:border-sky-500 sm:text-sm"
                                            />
                                            <div
                                                class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
                                            >
                                                <svg
                                                    class="validation-icon icon-valid h-5 w-5"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    viewBox="0 0 20 20"
                                                    fill="currentColor"
                                                >
                                                    <path
                                                        fill-rule="evenodd"
                                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                        clip-rule="evenodd"
                                                    ></path>
                                                </svg>
                                                <svg
                                                    class="validation-icon icon-invalid h-5 w-5"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    viewBox="0 0 20 20"
                                                    fill="currentColor"
                                                >
                                                    <path
                                                        fill-rule="evenodd"
                                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                                        clip-rule="evenodd"
                                                    ></path>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-wrapper">
                                        <label
                                            for="vehicle-model"
                                            class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1"
                                            data-translate-key="carModel"
                                            >Model</label
                                        >
                                        <div class="relative mt-1">
                                            <input
                                                type="text"
                                                id="vehicle-model"
                                                name="vehicle-model"
                                                required
                                                placeholder="e.g., F-150"
                                                class="input-field block w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-300 dark:focus:ring-sky-500 focus:border-sky-300 dark:focus:border-sky-500 sm:text-sm"
                                            />
                                            <div
                                                class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
                                            >
                                                <svg
                                                    class="validation-icon icon-valid h-5 w-5"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    viewBox="0 0 20 20"
                                                    fill="currentColor"
                                                >
                                                    <path
                                                        fill-rule="evenodd"
                                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                        clip-rule="evenodd"
                                                    ></path>
                                                </svg>
                                                <svg
                                                    class="validation-icon icon-invalid h-5 w-5"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    viewBox="0 0 20 20"
                                                    fill="currentColor"
                                                >
                                                    <path
                                                        fill-rule="evenodd"
                                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                                        clip-rule="evenodd"
                                                    ></path>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 text-center">
                            <button
                                type="button"
                                id="next-btn"
                                class="w-full cta-button inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-white rounded-full disabled:opacity-50 disabled:cursor-not-allowed"
                                >Next &rarr; Choose Service</button
                            >
                            <p
                                class="mt-2 text-xs text-gray-500 dark:text-slate-400"
                                data-translate-key="ctaUrgency"
                            >
                                Exclusive Online Offer – Valid This Month Only
                            </p>
                        </div>
                    </div>

                    <!-- Step 2: Service Selection -->
                    <div id="form-step-2" class="form-step hidden">
                        <div class="space-y-6">
                            <h2
                                class="h3 font-bold text-gray-900 dark:text-white mb-4"
                            >
                                Select a Service
                            </h2>
                            <div
                                class="grid grid-cols-2 sm:grid-cols-3 gap-4"
                                id="service-grid"
                            >
                                <!-- Brakes -->
                                <button
                                    type="button"
                                    class="service-card group p-4 rounded-2xl border-2 border-gray-100 dark:border-white/5 bg-gray-50/50 dark:bg-white/5 text-center transition-all duration-300 flex flex-col items-center gap-3"
                                    data-service="Brakes"
                                >
                                    <div
                                        class="service-icon-svg w-12 h-12 transition-transform duration-300"
                                    >
                                        <svg
                                            viewBox="0 0 433.001 433.001"
                                            fill="currentColor"
                                            ><g
                                                ><path
                                                    d="M428.204,192.538c-11.473-51.494-42.312-95.436-86.835-123.731c-27.493-17.471-58.783-27.834-91.005-30.26c-0.28-3.159-0.939-6.324-2.039-9.428c-4.908-13.854-17.038-23.412-31.655-24.943l-35.797-3.752c-19.693-2.064-39.013,4.782-53.014,18.781L19.143,127.921C5.144,141.92-1.702,161.242,0.361,180.934l3.752,35.797c1.532,14.617,11.09,26.747,24.943,31.655c3.108,1.101,6.276,1.781,9.439,2.06c4.745,62.002,38.275,118.231,90.993,151.733c32.771,20.827,69.392,30.763,105.617,30.76c65.369-0.005,129.419-32.372,167.009-91.506C430.411,296.909,439.676,244.03,428.204,192.538z M85.659,222.2l44.156-44.155c1.315,0.689,2.736,1.041,4.149,1.041c2.96,0,5.86-1.46,7.58-4.13c-0.01,0-0.01,0-0.01,0c1.811-2.822,1.847-6.266,0.405-9.036l28.438-28.438c1.598,1.266,3.578,1.954,5.606,1.954c1.49,0,3.011-0.37,4.41-1.16c4.33-2.45,5.86-7.94,3.41-12.27c-0.234-0.416-0.504-0.797-0.791-1.159l39.124-39.124c33.202-2.996,65.623,4.886,93.938,22.879c69.958,44.469,90.702,137.57,46.243,207.536c-21.543,33.892-54.995,57.366-94.194,66.098c-39.198,8.732-79.451,1.677-113.343-19.866c-24.146-15.347-43.305-37.081-55.401-62.851C88.039,275.363,83.331,248.696,85.659,222.2z M22.015,214.854l-3.752-35.797c-1.495-14.267,3.465-28.266,13.608-38.409L140.587,31.932c10.143-10.143,24.138-15.102,38.408-13.608l35.797,3.752c7.766,0.814,13.958,5.693,16.565,13.052c2.606,7.359,0.867,15.048-4.653,20.569L55.636,226.766c-5.521,5.521-13.214,7.259-20.568,4.653C27.709,228.812,22.829,222.619,22.015,214.854z"
                                                ></path></g
                                            ></svg
                                        >
                                    </div>
                                    <span
                                        class="text-sm font-bold text-gray-700 dark:text-slate-200"
                                        >Brakes</span
                                    >
                                </button>
                                <!-- Diagnostics -->
                                <button
                                    type="button"
                                    class="service-card group p-4 rounded-2xl border-2 border-gray-100 dark:border-white/5 bg-gray-50/50 dark:bg-white/5 text-center transition-all duration-300 flex flex-col items-center gap-3"
                                    data-service="Diagnostics"
                                >
                                    <div
                                        class="service-icon-svg w-12 h-12 transition-transform duration-300"
                                    >
                                        <svg
                                            viewBox="144 144 512 512"
                                            fill="currentColor"
                                            ><g
                                                ><path
                                                    d="m311.47 384.88h-36.863v92.047h43.668l25.418 39.406h192.09l-0.003906-132.27h-43.668l-42.848-35.219h-105.56zm80.902 6.7305h35.887l-3.1406 26.465h28.559l-45.082 65.125-1.6445-40.902-21.387 0.078125z"
                                                ></path><path
                                                    d="m408.92 333.89v-25.688h37.242v-24.547h-102.45v24.547h37.242v25.688z"
                                                ></path><path
                                                    d="m210.82 476.92h23.176v-39.496h25.688v-27.969h-25.688v-24.547h-38.957v33.387h15.781z"
                                                ></path><path
                                                    d="m576.42 428.71h-25.688v27.969h25.688v49.344l28.543-8.9414v-93.82l-28.543-8.9414z"
                                                ></path></g
                                            ></svg
                                        >
                                    </div>
                                    <span
                                        class="text-sm font-bold text-gray-700 dark:text-slate-200"
                                        >Diagnostics</span
                                    >
                                </button>
                                <!-- Oil Change -->
                                <button
                                    type="button"
                                    class="service-card group p-4 rounded-2xl border-2 border-gray-100 dark:border-white/5 bg-gray-50/50 dark:bg-white/5 text-center transition-all duration-300 flex flex-col items-center gap-3"
                                    data-service="Oil Change"
                                >
                                    <div
                                        class="service-icon-svg w-12 h-12 transition-transform duration-300"
                                    >
                                        <svg
                                            viewBox="144 144 512 512"
                                            fill="currentColor"
                                            ><g fill-rule="evenodd"
                                                ><path
                                                    d="m411.12 399.37c-6.1523-6.1523-16.102-6.1523-22.25 0 0 0-15.785 15.742-28.383 35.918-9.3633 14.969-16.605 32.285-16.605 47.883 0 25.465 24.266 48.031 56.113 48.031 31.844 0 56.113-22.566 56.113-48.031 0-15.598-7.2422-32.914-16.605-47.883-12.594-20.172-28.383-35.918-28.383-35.918zm-11.125 34.824c4.0312 4.9766 8.6289 11.082 12.805 17.781 6.1523 9.8438 11.82 20.93 11.82 31.195 0 10.223-11.84 16.543-24.625 16.543s-24.625-6.3203-24.625-16.543c0-10.266 5.668-21.348 11.82-31.195 4.1758-6.6953 8.7734-12.805 12.805-17.781z"
                                                ></path><path
                                                    d="m562.69 567.93v-222.94c0-8.9844-3.2969-17.676-9.2773-24.395l-72.402-81.469c-6.9688-7.8281-16.961-12.324-27.457-12.324h-179.5c-20.277 0-36.734 16.438-36.734 36.734v304.39c0 31.887 25.84 57.727 57.727 57.727h209.92c31.887 0 57.727-25.84 57.727-57.727zm-31.488-222.94v222.94c0 14.484-11.754 26.238-26.238 26.238h-209.92c-14.484 0-26.238-11.754-26.238-26.238v-304.39c0-2.8984 2.3516-5.2461 5.2461-5.2461h179.5c1.4922 0 2.918 0.65234 3.9258 1.7617 0 0 72.402 81.449 72.402 81.449 0.85938 0.96484 1.3242 2.2031 1.3242 3.4844z"
                                                ></path><path
                                                    d="m415.74 190.08c0-8.6914-7.0547-15.742-15.742-15.742h-115.46c-8.6914 0-15.742 7.0547-15.742 15.742v52.48c0 8.6914 7.0547 15.742 15.742 15.742h115.46c8.6914 0 15.742-7.0547 15.742-15.742zm-31.488 15.742v20.992h-83.969v-20.992z"
                                                ></path><path
                                                    d="m506.24 379.05-83.969-94.465c-5.7734-6.5078-15.742-7.0938-22.23-1.3242-6.5078 5.7734-7.0938 15.742-1.3242 22.23l83.969 94.465c5.7734 6.5078 15.742 7.0938 22.23 1.3242 6.5078-5.7734 7.0938-15.742 1.3242-22.23z"
                                                ></path></g
                                            ></svg
                                        >
                                    </div>
                                    <span
                                        class="text-sm font-bold text-gray-700 dark:text-slate-200"
                                        >Oil Change</span
                                    >
                                </button>
                                <!-- Tires -->
                                <button
                                    type="button"
                                    class="service-card group p-4 rounded-2xl border-2 border-gray-100 dark:border-white/5 bg-gray-50/50 dark:bg-white/5 text-center transition-all duration-300 flex flex-col items-center gap-3"
                                    data-service="Tires"
                                >
                                    <div
                                        class="service-icon-svg w-12 h-12 transition-transform duration-300"
                                    >
                                        <svg
                                            viewBox="0 0 512 512"
                                            fill="currentColor"
                                        >
                                            <g>
                                                <path
                                                    d="M498.842,256c0-1.092-0.065-2.169-0.08-3.277c4.418-1.182,8.836-2.436,13.238-3.739 c-0.348-12.057-1.489-24.098-3.52-36.002c-4.556-0.445-9.136-0.809-13.708-1.124c-3.318-18.046-8.594-35.411-15.666-51.838 c3.609-2.768,7.186-5.632,10.762-8.529c-4.96-11.013-10.657-21.687-17.099-31.882c-4.369,1.343-8.731,2.767-13.085,4.232 c-9.913-15.253-21.476-29.318-34.463-41.941c2.274-3.965,4.636-7.858,6.821-11.896c-8.764-8.286-18.11-15.949-27.934-22.957 c-3.544,2.929-6.886,6.004-10.325,8.999c-14.841-10.254-30.904-18.871-47.889-25.628c0.599-4.548,1.125-9.112,1.594-13.676 c-11.272-4.322-22.884-7.818-34.65-10.504c-2.153,4.079-4.224,8.133-6.24,12.219c-16.33-3.456-33.25-5.308-50.599-5.308 c-1.158,0-2.29,0.065-3.447,0.097C251.355,8.82,250.279,4.394,248.968,0c-12.041,0.348-24.082,1.489-35.985,3.52 c-0.445,4.564-0.81,9.127-1.125,13.708c-18.069,3.318-35.41,8.594-51.837,15.65c-2.792-3.601-5.632-7.178-8.529-10.746 c-11.013,4.952-21.678,10.649-31.883,17.099c1.343,4.369,2.768,8.731,4.232,13.085C108.596,62.22,94.516,73.792,81.9,86.779 c-3.965-2.282-7.857-4.653-11.895-6.821c-8.286,8.755-15.949,18.102-22.957,27.934c2.921,3.544,6.004,6.894,8.998,10.342 c-10.252,14.841-18.87,30.871-25.635,47.864c-4.54-0.574-9.096-1.108-13.652-1.578c-4.337,11.297-7.833,22.876-10.52,34.634 c4.078,2.152,8.14,4.232,12.227,6.247c-3.464,16.33-5.316,33.25-5.316,50.599c0,1.092,0.064,2.193,0.072,3.277 c-4.402,1.182-8.828,2.428-13.222,3.754c0.348,12.033,1.482,24.074,3.513,35.977c4.556,0.438,9.135,0.818,13.715,1.134 c3.318,18.045,8.594,35.41,15.65,51.837c-3.601,2.776-7.17,5.624-10.746,8.521c4.944,11.03,10.641,21.695,17.098,31.891 c4.37-1.336,8.731-2.744,13.069-4.233c9.92,15.27,21.492,29.302,34.48,41.942c-2.282,3.965-4.653,7.848-6.821,11.878 c8.747,8.303,18.101,15.974,27.934,22.974c3.544-2.937,6.886-6.012,10.325-9.006c14.841,10.252,30.888,18.878,47.881,25.643 c-0.591,4.556-1.134,9.112-1.586,13.676c11.272,4.322,22.876,7.809,34.65,10.496c2.136-4.078,4.224-8.149,6.238-12.227 c16.33,3.464,33.25,5.309,50.6,5.309c1.157,0,2.29-0.065,3.439-0.073c1.206,4.402,2.266,8.828,3.577,13.23 c12.041-0.347,24.09-1.481,35.985-3.512c0.445-4.564,0.825-9.136,1.141-13.716c18.046-3.317,35.412-8.577,51.838-15.666 c2.768,3.617,5.616,7.186,8.512,10.762c11.03-4.944,21.687-10.648,31.899-17.098c-1.335-4.362-2.743-8.731-4.232-13.085 c15.245-9.913,29.326-21.469,41.941-34.464c3.965,2.29,7.85,4.644,11.888,6.821c8.294-8.764,15.965-18.101,22.957-27.934 c-2.937-3.544-5.996-6.886-8.99-10.326c10.252-14.841,18.846-30.895,25.636-47.889c4.556,0.599,9.112,1.117,13.667,1.57 c4.321-11.248,7.801-22.86,10.504-34.626c-4.079-2.136-8.149-4.224-12.228-6.238C496.998,290.27,498.842,273.357,498.842,256z M256,410.793c-85.501,0-154.809-69.292-154.809-154.793c0-85.5,69.308-154.8,154.809-154.8c85.484,0,154.809,69.3,154.809,154.8 C410.809,341.501,341.485,410.793,256,410.793z"
                                                ></path>
                                                <path
                                                    d="M256,270.962c8.262,0,14.962-6.692,14.962-14.962c0-8.27-6.7-14.97-14.962-14.97 c-8.278,0-14.978,6.7-14.978,14.97C241.022,264.27,247.722,270.962,256,270.962z"
                                                ></path>
                                                <path
                                                    d="M156.136,199.687c1.044,2.808,3.31,4.977,6.15,5.907l53.33,17.342c4.968,1.602,10.406,0.752,14.623-2.323 c4.232-3.075,6.724-7.979,6.724-13.206v-56.062c0-2.994-1.376-5.826-3.714-7.671c-2.347-1.861-5.406-2.541-8.327-1.861 c0,0,0.802-0.606-4.588,1.085c-25.191,7.938-46.756,24.042-61.572,45.218c-3.035,4.354-1.861,3.107-1.861,3.107 C155.384,193.772,155.092,196.887,156.136,199.687z"
                                                ></path>
                                                <path
                                                    d="M214.391,269.53c-1.61-4.977-5.51-8.877-10.463-10.479l-53.327-17.325c-2.865-0.931-5.956-0.494-8.448,1.157 c-2.5,1.659-4.094,4.369-4.329,7.347c0,0-0.34-0.946-0.388,4.71c-0.251,26.396,8.407,51.878,23.96,72.52 c3.204,4.241,2.379,2.744,2.379,2.744c1.95,2.25,4.823,3.496,7.801,3.374c2.994-0.13,5.762-1.602,7.517-4.03l32.967-45.396 C215.152,279.936,216.001,274.482,214.391,269.53z"
                                                ></path>
                                                <path
                                                    d="M269.198,306.47c-3.074-4.216-7.978-6.716-13.198-6.716c-5.22,0-10.123,2.5-13.206,6.716l-32.943,45.356c-1.764,2.42-2.314,5.51-1.513,8.399c0.818,2.889,2.889,5.228,5.656,6.393c0,0-1.011,0.025,4.346,1.82 c25.044,8.392,51.951,8.028,76.388-0.396c5.025-1.724,3.334-1.4,3.334-1.4c2.752-1.158,4.823-3.512,5.616-6.385 c0.817-2.889,0.251-5.98-1.506-8.392L269.198,306.47z"
                                                ></path>
                                                <path
                                                    d="M361.448,241.709l-53.375,17.342c-4.952,1.602-8.853,5.502-10.471,10.479 c-1.611,4.953-0.752,10.407,2.323,14.614l32.958,45.356c1.748,2.436,4.515,3.893,7.509,4.038c2.995,0.122,5.868-1.141,7.826-3.406 c0,0-0.283,0.963,3.084-3.576c15.706-21.218,23.685-46.934,23.224-72.764c-0.089-5.3-0.307-3.593-0.307-3.593 c-0.235-2.986-1.846-5.697-4.338-7.348C367.395,241.216,364.28,240.779,361.448,241.709z"
                                                ></path>
                                                <path
                                                    d="M281.708,220.613c4.233,3.059,9.67,3.924,14.63,2.323l53.327-17.342c2.848-0.922,5.114-3.099,6.15-5.907 c1.036-2.8,0.744-5.923-0.818-8.488c0,0,0.834,0.567-2.452-4.03c-15.318-21.508-37.288-37.038-62.025-44.596 c-5.065-1.537-3.528-0.809-3.528-0.809c-2.905-0.68-5.956,0.008-8.31,1.877c-2.331,1.837-3.69,4.669-3.69,7.656v56.11 C274.984,212.634,277.492,217.538,281.708,220.613z"
                                                ></path>
                                            </g>
                                        </svg>
                                    </div>
                                    <span
                                        class="text-sm font-bold text-gray-700 dark:text-slate-200"
                                        >Tires</span
                                    >
                                </button>
                                <!-- Electrical -->
                                <button
                                    type="button"
                                    class="service-card group p-4 rounded-2xl border-2 border-gray-100 dark:border-white/5 bg-gray-50/50 dark:bg-white/5 text-center transition-all duration-300 flex flex-col items-center gap-3"
                                    data-service="Electrical"
                                >
                                    <div
                                        class="service-icon-svg w-12 h-12 transition-transform duration-300"
                                    >
                                        <svg
                                            viewBox="144 144 512 512"
                                            fill="currentColor"
                                            ><path
                                                d="m480.2 214.84-187.64 174.62 80.348 42.262c5.2148 2.7344 7.3906 8.9922 5.168 14.328l-58.266 139.11 187.64-174.62-80.348-42.262c-5.2148-2.7344-7.3906-8.9922-5.168-14.328zm-214.71 168.92 237.4-220.9c3.1289-3.1445 7.9805-4.2461 12.332-2.4492 5.7578 2.4023 8.4961 9.0078 6.1055 14.781l-74.527 177.91 85.078 44.754c1.1797 0.58984 2.2656 1.3906 3.2031 2.4023 4.2461 4.5664 3.9883 11.715-0.57422 15.961l-237.4 220.9c-3.1289 3.1445-7.9805 4.2461-12.332 2.4492-5.7578-2.4023-8.4961-9.0078-6.1055-14.781l74.527-177.91-85.078-44.754c-1.1797-0.58984-2.2656-1.3906-3.2031-2.4023-4.2461-4.5664-3.9883-11.715 0.57422-15.961z"
                                            ></path></svg
                                        >
                                    </div>
                                    <span
                                        class="text-sm font-bold text-gray-700 dark:text-slate-200"
                                        >Electrical</span
                                    >
                                </button>
                                <!-- Steering -->
                                <button
                                    type="button"
                                    class="service-card group p-4 rounded-2xl border-2 border-gray-100 dark:border-white/5 bg-gray-50/50 dark:bg-white/5 text-center transition-all duration-300 flex flex-col items-center gap-3"
                                    data-service="Steering"
                                >
                                    <div
                                        class="service-icon-svg w-12 h-12 transition-transform duration-300"
                                    >
                                        <svg
                                            viewBox="0 0 512 512"
                                            fill="currentColor"
                                            ><path
                                                d="M256,0C114.615,0,0,114.615,0,256s114.615,256,256,256s256-114.615,256-256S397.385,0,256,0z M256,469.333c-117.632,0-213.333-95.701-213.333-213.333S138.368,42.667,256,42.667S469.333,138.368,469.333,256S373.632,469.333,256,469.333z"
                                            ></path><circle
                                                cx="256"
                                                cy="256"
                                                r="42.667"></circle><path
                                                d="M256,170.667c-47.061,0-85.333,38.272-85.333,85.333h42.667c0-23.531,19.136-42.667,42.667-42.667V170.667z"
                                            ></path><path
                                                d="M341.333,256c0-47.061-38.272-85.333-85.333-85.333v42.667c23.531,0,42.667,19.136,42.667,42.667H341.333z"
                                            ></path><rect
                                                x="234.667"
                                                y="298.667"
                                                width="42.667"
                                                height="128"></rect><rect
                                                x="64"
                                                y="234.667"
                                                width="128"
                                                height="42.667"></rect><rect
                                                x="320"
                                                y="234.667"
                                                width="128"
                                                height="42.667"></rect></svg
                                        >
                                    </div>
                                    <span
                                        class="text-sm font-bold text-gray-700 dark:text-slate-200"
                                        >Steering</span
                                    >
                                </button>
                            </div>

                            <input
                                type="hidden"
                                id="symptom"
                                name="service_type"
                                required
                            />

                            <div class="mt-8">
                                <label
                                    for="user-comments"
                                    class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2"
                                >
                                    Tell us more about the service (Optional)
                                </label>
                                <textarea
                                    id="user-comments"
                                    name="user_comments"
                                    rows="3"
                                    placeholder="Describe the service or specific needs..."
                                    class="input-field block w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-300 dark:border-slate-600 rounded-xl shadow-sm text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-300 dark:focus:ring-sky-500 focus:border-sky-300 dark:focus:border-sky-500 sm:text-sm transition-all duration-300"
                                ></textarea>
                            </div>

                            <div
                                class="mt-8 flex flex-col sm:flex-row items-center justify-between gap-4"
                            >
                                <button
                                    type="button"
                                    id="step2-back-btn"
                                    class="w-full sm:w-auto inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-gray-600 dark:text-slate-300 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"
                                    >← Back</button
                                >
                                <button
                                    type="button"
                                    id="step2-next-btn"
                                    class="w-full sm:w-auto cta-button inline-flex items-center justify-center px-8 py-4 text-xl font-bold text-white rounded-full disabled:opacity-50 disabled:cursor-not-allowed"
                                    disabled>Next &rarr; Pick a Time</button
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Date & Time -->
                    <div id="form-step-3" class="form-step hidden">
                        <div class="space-y-8">
                            <div>
                                <h2
                                    class="h3 font-bold text-gray-900 dark:text-white mb-4"
                                    data-translate-key="whenBringIn"
                                >
                                    When can you bring it in?
                                </h2>
                                <div
                                    id="calendar-container"
                                    class="bg-gray-50/50 dark:bg-white/5 p-6 rounded-2xl border border-gray-100 dark:border-white/5 shadow-lg w-full"
                                >
                                    <div
                                        class="flex items-center justify-between mb-6"
                                    >
                                        <button
                                            type="button"
                                            id="prev-month-btn"
                                            class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors"
                                            ><i
                                                data-lucide="chevron-left"
                                                class="w-6 h-6 text-gray-500 dark:text-slate-400"
                                            ></i></button
                                        ><h3
                                            id="month-year"
                                            class="text-xl font-semibold text-gray-900 dark:text-white"
                                        >
                                        </h3><button
                                            type="button"
                                            id="next-month-btn"
                                            class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors"
                                            ><i
                                                data-lucide="chevron-right"
                                                class="w-6 h-6 text-gray-500 dark:text-slate-400"
                                            ></i></button
                                        >
                                    </div>
                                    <div
                                        class="grid grid-cols-7 gap-1 text-center"
                                        id="calendar-grid-header"
                                    >
                                    </div>
                                    <div
                                        class="grid grid-cols-7 gap-2 text-center mt-2"
                                        id="calendar-grid-body"
                                    >
                                    </div>
                                </div>
                                <input type="hidden" id="date" name="date" />
                                <div
                                    id="time-slot-container"
                                    class="mt-8 hidden"
                                >
                                    <h4
                                        class="text-lg font-semibold text-gray-900 dark:text-white mb-4"
                                        data-translate-key="availableTimes"
                                    >
                                        Available Times
                                    </h4><div
                                        id="time-slots"
                                        class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"
                                    >
                                    </div>
                                </div>
                                <input type="hidden" id="time" name="time" />
                            </div>
                            <div class="mt-8 text-center">
                                <div
                                    class="flex flex-col sm:flex-row items-center justify-between gap-4"
                                >
                                    <button
                                        type="button"
                                        id="back-btn"
                                        class="w-full sm:w-auto inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-gray-600 dark:text-slate-300 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors"
                                        >← Back</button
                                    >
                                    <button
                                        type="submit"
                                        id="submit-btn"
                                        class="w-full sm:w-auto cta-button inline-flex items-center justify-center px-8 py-4 text-xl font-bold text-white rounded-full disabled:opacity-50 disabled:cursor-not-allowed"
                                        data-translate-key="submitBtn"
                                        >Book My Service</button
                                    >
                                </div>
                                <p
                                    class="mt-2 text-xs text-gray-500 dark:text-slate-400"
                                    data-translate-key="ctaUrgency"
                                >
                                    Exclusive Online Offer – Valid This Month
                                    Only
                                </p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script is:inline>
    (function () {
        // --- Form Props Extraction ---
        const formWrapper = document.getElementById("book-appointment-form");
        const WEBHOOK_URL = formWrapper.dataset.webhook;
        const PROMO_CODE = formWrapper.dataset.promo;
        const THANK_YOU_URL = formWrapper.dataset.thankyou;

        const translations = {
            en: {
                step1Title: "Book",
                step1Desc: "Book online to get your savings code.",
                step2Title: "Show Up",
                step2Desc: "Bring your car. We’ll handle the rest.",
                step3Title: "Save",
                step3Desc: "Show your code to apply your discount.",
                formInstruction1:
                    "Step 1 of 2 — Your contact and vehicle details.",
                formInstruction2: "Step 2 of 2 — When can you bring it in?",
                firstName: "First Name",
                lastName: "Last Name",
                email: "Email",
                mobileNumber: "Mobile Number",
                vehicleDetails: "Vehicle Details",
                carYear: "Year",
                carMake: "Make",
                carModel: "Model",
                noPaymentRequired:
                    "No payment required — this just saves your spot.",
                whenBringIn: "When can you bring it in?",
                availableTimes: "Available Times",
                submitBtn: "Book My Service",
                ctaUrgency: "Exclusive Online Offer – Valid This Month Only",
            },
            es: {
                step1Title: "Reserva",
                step1Desc: "Reserva en línea para obtener tu código de ahorro.",
                step2Title: "Visítanos",
                step2Desc: "Trae tu auto. Nosotros nos encargamos.",
                step3Title: "Ahorra",
                step3Desc: "Muestra tu código para aplicar tu descuento.",
                formInstruction1:
                    "Paso 1 de 2 — Tus datos de contacto y del vehículo.",
                formInstruction2: "Paso 2 de 2 — ¿Cuándo puedes traerlo?",
                firstName: "Nombre",
                lastName: "Apellido",
                email: "Correo Electrónico",
                mobileNumber: "Número de Celular",
                vehicleDetails: "Detalles del Vehículo",
                carYear: "Año",
                carMake: "Marca",
                carModel: "Modelo",
                noPaymentRequired:
                    "No se requiere pago — esto solo guarda tu lugar.",
                whenBringIn: "¿Cuándo puedes traerlo?",
                availableTimes: "Horas Disponibles",
                submitBtn: "Reservar Mi Servicio",
                ctaUrgency: "Oferta Exclusiva en Línea – Válida Solo Este Mes",
            },
        };

        const form = document.getElementById("booking-form");
        if (!form) return;

        // --- URL Parameter & Tracking Population ---
        const urlParams = new URLSearchParams(window.location.search);
        const trackingFields = [
            "utm_source",
            "utm_medium",
            "utm_campaign",
            "utm_term",
            "utm_content",
            "gclid",
            "fbc",
            "fbclid",
            "msclkid",
        ];

        trackingFields.forEach((field) => {
            const el = form.querySelector(`input[name="${field}"]`);
            if (el && urlParams.has(field)) {
                el.value = urlParams.get(field);
            }
        });

        // Set Referrer
        const referrerEl = form.querySelector('input[name="referrer"]');
        if (referrerEl) {
            referrerEl.value = document.referrer || "";
        }

        // Generate Event ID if not present
        const eventIdEl = form.querySelector('input[name="event_id"]');
        if (eventIdEl && !eventIdEl.value) {
            eventIdEl.value =
                "ev_" +
                Math.random().toString(36).substr(2, 9) +
                "_" +
                Date.now();
        }

        // Try to grab fbc from cookie if not in URL
        const fbcEl = form.querySelector('input[name="fbc"]');
        if (fbcEl && !fbcEl.value) {
            const fbcCookie = document.cookie
                .split("; ")
                .find((row) => row.startsWith("_fbc="));
            if (fbcCookie) fbcEl.value = fbcCookie.split("=")[1];
        }

        // Try to grab GA Client ID
        const gaClientIdEl = form.querySelector('input[name="ga_client_id"]');
        if (gaClientIdEl && !gaClientIdEl.value) {
            try {
                if (typeof ga !== "undefined") {
                    ga.getAll().forEach((tracker) => {
                        gaClientIdEl.value = tracker.get("clientId");
                    });
                }
            } catch (e) {}
        }

        const step1 = document.getElementById("form-step-1");
        const step2 = document.getElementById("form-step-2");
        const step3 = document.getElementById("form-step-3");
        const formInstruction = document.getElementById("form-instruction");
        const nextBtn = document.getElementById("next-btn");
        const step2NextBtn = document.getElementById("step2-next-btn");
        const step2BackBtn = document.getElementById("step2-back-btn");
        const backBtn = document.getElementById("back-btn");

        // --- Progress Stepper Update Function ---
        const progressBar = document.getElementById("stepper-progress-bar");
        const stepElements = document.querySelectorAll(".progress-steps .step");
        const totalSteps = stepElements.length;

        const updateProgressStepper = (currentStep) => {
            // Update progress bar width
            const progressPercent =
                ((currentStep - 1) / (totalSteps - 1)) * 100;

            if (progressBar) {
                progressBar.style.width = `${progressPercent}%`;
            }

            // Update step circles
            stepElements.forEach((stepEl, index) => {
                const stepNum = index + 1;
                stepEl.classList.remove("active", "completed");

                if (stepNum < currentStep) {
                    stepEl.classList.add("completed");
                } else if (stepNum === currentStep) {
                    stepEl.classList.add("active");
                }
            });
        };

        // Initialize stepper to step 1
        updateProgressStepper(1);
        const submitBtn = document.getElementById("submit-btn");
        let calendarDate = new Date();
        const monthYearEl = document.getElementById("month-year");
        const calendarGridHeader = document.getElementById(
            "calendar-grid-header",
        );
        const calendarGridBody = document.getElementById("calendar-grid-body");
        const hiddenDateInput = document.getElementById("date");
        const hiddenTimeInput = document.getElementById("time");
        const timeSlotContainer = document.getElementById(
            "time-slot-container",
        );
        const timeSlotsEl = document.getElementById("time-slots");

        if (typeof lucide !== "undefined") lucide.createIcons();

        // --- Form Logic & Validation ---
        const validationRules = {
            "first-name": (value) => value.trim().length >= 2,
            "last-name": (value) => value.trim().length >= 2,
            email: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
            "mobile-number": (value) => value.replace(/\D/g, "").length >= 10,
            "vehicle-make": (value) => value.trim().length >= 2,
            "vehicle-model": (value) => value.trim().length >= 1,
        };

        const validateField = (inputEl) => {
            const rule = validationRules[inputEl.id];
            if (!rule) return;

            const wrapper = inputEl.closest(".input-wrapper");
            const isValid = rule(inputEl.value);

            wrapper.classList.remove("is-valid", "is-invalid");
            inputEl.classList.remove("is-valid", "is-invalid");

            if (inputEl.value.trim() === "") return;

            if (isValid) {
                wrapper.classList.add("is-valid");
                inputEl.classList.add("is-valid");
            } else {
                wrapper.classList.add("is-invalid");
                inputEl.classList.add("is-invalid");
            }
        };

        const step1Fields = [
            "first-name",
            "last-name",
            "email",
            "mobile-number",
            "vehicle-year",
            "vehicle-make",
            "vehicle-model",
        ];
        const step2Fields = ["symptom"];
        const step3Fields = ["date", "time"];

        const checkStep1Completion = () => {
            if (nextBtn)
                nextBtn.disabled = !step1Fields.every(
                    (id) => document.getElementById(id)?.value.trim() !== "",
                );
        };
        const checkStep2Completion = () => {
            if (step2NextBtn)
                step2NextBtn.disabled = !step2Fields.every(
                    (id) => document.getElementById(id)?.value.trim() !== "",
                );
        };
        const checkStep3Completion = () => {
            if (submitBtn)
                submitBtn.disabled = !step3Fields.every(
                    (id) => document.getElementById(id)?.value.trim() !== "",
                );
        };

        step1Fields.forEach((id) => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener("input", () => {
                    validateField(el);
                    checkStep1Completion();
                });
            }
        });

        const smoothScrollToForm = () => {
            const formElement = document.getElementById(
                "form-container-wrapper",
            );
            const header = document.getElementById("site-header");
            if (formElement) {
                const headerHeight = header ? header.offsetHeight : 0;
                const elementPosition =
                    formElement.getBoundingClientRect().top +
                    window.pageYOffset;
                const offsetPosition = elementPosition - headerHeight - 20; // 20px buffer for spacing

                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth",
                });
            }
        };

        // --- Service Selection Logic ---
        const serviceCards = document.querySelectorAll(".service-card");
        const symptomInput = document.getElementById("symptom");

        serviceCards.forEach((card) => {
            card.addEventListener("click", () => {
                // Remove active classes from all
                serviceCards.forEach((c) => {
                    c.classList.remove(
                        "selected",
                        "border-sky-500",
                        "bg-sky-50/10",
                        "ring-2",
                        "ring-sky-500/20",
                    );
                });
                // Add to clicked
                card.classList.add(
                    "selected",
                    "border-sky-500",
                    "bg-sky-50/10",
                    "ring-2",
                    "ring-sky-500/20",
                );
                if (symptomInput) {
                    symptomInput.value = card.dataset.service;
                    checkStep2Completion();
                }
            });
        });

        if (nextBtn) {
            nextBtn.addEventListener("click", () => {
                step1.classList.add("hidden");
                step2.classList.remove("hidden");
                if (formInstruction) {
                    formInstruction.textContent =
                        formWrapper.dataset.step2desc ||
                        "Step 2 of 3 — What service does your vehicle need?";
                }
                updateProgressStepper(2);
                smoothScrollToForm();
            });
        }

        if (step2NextBtn) {
            step2NextBtn.addEventListener("click", () => {
                step2.classList.add("hidden");
                step3.classList.remove("hidden");
                if (formInstruction) {
                    formInstruction.textContent =
                        formWrapper.dataset.step3desc ||
                        "Step 3 of 3 — When can you bring it in?";
                }
                updateProgressStepper(3);
                smoothScrollToForm();
            });
        }

        if (step2BackBtn) {
            step2BackBtn.addEventListener("click", () => {
                step2.classList.add("hidden");
                step1.classList.remove("hidden");
                if (formInstruction) {
                    formInstruction.textContent =
                        formWrapper.dataset.step1desc ||
                        "Step 1 of 3 — Your contact and vehicle details.";
                }
                updateProgressStepper(1);
                smoothScrollToForm();
            });
        }

        if (backBtn) {
            backBtn.addEventListener("click", () => {
                step3.classList.add("hidden");
                step2.classList.remove("hidden");
                if (formInstruction) {
                    formInstruction.textContent =
                        formWrapper.dataset.step2desc ||
                        "Step 2 of 3 — What service does your vehicle need?";
                }
                updateProgressStepper(2);
                smoothScrollToForm();
            });
        }

        // --- Calendar ---
        function renderCalendar() {
            if (!monthYearEl || !calendarGridHeader || !calendarGridBody)
                return;
            const month = calendarDate.getMonth();
            const year = calendarDate.getFullYear();
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const lang = localStorage.getItem("preferredLanguage") || "en";
            const daysOfWeek =
                lang === "es"
                    ? ["D", "L", "M", "M", "J", "V", "S"]
                    : ["S", "M", "T", "W", "T", "F", "S"];
            monthYearEl.textContent = new Intl.DateTimeFormat(lang, {
                month: "long",
                year: "numeric",
            }).format(calendarDate);
            calendarGridHeader.innerHTML = daysOfWeek
                .map(
                    (day) =>
                        `<div class="font-semibold text-slate-400 text-xs py-2 text-center">${day}</div>`,
                )
                .join("");
            calendarGridBody.innerHTML = "";
            const firstDayOfMonth = new Date(year, month, 1).getDay();
            for (let i = 0; i < firstDayOfMonth; i++)
                calendarGridBody.innerHTML += `<div></div>`;

            const holidays = [
                "12-24", // Christmas Eve
                "12-25", // Christmas Day
                "12-31", // New Year's Eve
                "01-01", // New Year's Day
            ];

            const daysInMonth = new Date(year, month + 1, 0).getDate();
            for (let i = 1; i <= daysInMonth; i++) {
                const dayDate = new Date(year, month, i);
                let classes = "calendar-day";
                const formattedDate = `${year}-${String(month + 1).padStart(2, "0")}-${String(i).padStart(2, "0")}`;
                const monthDay = `${String(month + 1).padStart(2, "0")}-${String(i).padStart(2, "0")}`;
                const isHoliday = holidays.includes(monthDay);

                if (dayDate < today || dayDate.getDay() === 0 || isHoliday) {
                    classes += " disabled";
                    if (isHoliday) classes += " holiday";
                }
                if (dayDate.getTime() === today.getTime()) classes += " today";
                if (hiddenDateInput.value === formattedDate)
                    classes += " selected";
                calendarGridBody.innerHTML += `<div class="${classes}" data-date="${formattedDate}">${i}</div>`;
            }
        }

        function renderTimeSlots() {
            if (!timeSlotContainer || !timeSlotsEl) return;
            timeSlotContainer.classList.remove("hidden");
            timeSlotsEl.innerHTML = "";
            const selectedDate = new Date(
                hiddenDateInput.value.replace(/-/g, "/"),
            );
            const now = new Date();
            const dayOfWeek = selectedDate.getDay();
            let availableTimes =
                dayOfWeek === 6
                    ? [
                          "08:00 AM",
                          "08:30 AM",
                          "09:00 AM",
                          "09:30 AM",
                          "10:00 AM",
                          "10:30 AM",
                          "11:00 AM",
                          "11:30 AM",
                          "12:00 PM",
                          "12:30 PM",
                          "01:00 PM",
                          "01:30 PM",
                      ]
                    : [
                          "08:00 AM",
                          "08:30 AM",
                          "09:00 AM",
                          "09:30 AM",
                          "10:00 AM",
                          "10:30 AM",
                          "11:00 AM",
                          "11:30 AM",
                          "12:00 PM",
                          "12:30 PM",
                          "02:00 PM",
                          "02:30 PM",
                          "03:00 PM",
                          "03:30 PM",
                      ];

            let slotsAdded = 0;
            availableTimes.forEach((time) => {
                const [hourStr, minStr, period] = time
                    .match(/(\d+):(\d+)\s(AM|PM)/)
                    .slice(1);
                let hours = parseInt(hourStr);
                if (period === "PM" && hours < 12) hours += 12;
                if (period === "AM" && hours === 12) hours = 0;

                const timeSlotDate = new Date(selectedDate);
                timeSlotDate.setHours(hours, parseInt(minStr), 0, 0);

                if (timeSlotDate > now) {
                    slotsAdded++;
                    const timeSlotBtn = document.createElement("button");
                    timeSlotBtn.type = "button";
                    timeSlotBtn.textContent = time;
                    timeSlotBtn.className =
                        "time-slot p-2 border border-slate-600 rounded-md text-slate-200 transition-colors duration-200 hover:bg-slate-700";
                    if (hiddenTimeInput.value === time)
                        timeSlotBtn.classList.add("selected");
                    timeSlotBtn.addEventListener("click", () => {
                        document
                            .querySelectorAll("#time-slots .time-slot")
                            .forEach((btn) => btn.classList.remove("selected"));
                        timeSlotBtn.classList.add("selected");
                        hiddenTimeInput.value = time;
                        checkStep3Completion();
                    });
                    timeSlotsEl.appendChild(timeSlotBtn);
                }
            });
            if (slotsAdded === 0)
                timeSlotsEl.innerHTML = `<p class="text-slate-400 col-span-full text-center">All appointment times for today have passed.</p>`;
        }

        if (calendarGridBody) {
            calendarGridBody.addEventListener("click", (e) => {
                const dayElement = e.target.closest(
                    ".calendar-day:not(.disabled)",
                );
                if (dayElement) {
                    document
                        .querySelectorAll(".calendar-day")
                        .forEach((day) => day.classList.remove("selected"));
                    dayElement.classList.add("selected");
                    hiddenDateInput.value = dayElement.dataset.date;
                    hiddenTimeInput.value = "";
                    checkStep3Completion();
                    renderTimeSlots();
                }
            });
        }

        document
            .getElementById("prev-month-btn")
            ?.addEventListener("click", () => {
                calendarDate.setMonth(calendarDate.getMonth() - 1);
                renderCalendar();
            });
        document
            .getElementById("next-month-btn")
            ?.addEventListener("click", () => {
                calendarDate.setMonth(calendarDate.getMonth() + 1);
                renderCalendar();
            });

        const yearSelect = document.getElementById("vehicle-year");
        const currentYear = new Date().getFullYear() + 1;
        for (let year = currentYear; year >= 1980; year--) {
            yearSelect?.appendChild(new Option(year, year.toString()));
        }

        form?.addEventListener("submit", async (e) => {
            e.preventDefault();
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><span>Booking...</span>`;
            }
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            const formattedPhone = `+1${(data["mobile-number"] || "").replace(/\D/g, "")}`;

            const webhookData = {
                ...data,
                event_name: "generate_lead",
                phone: formattedPhone,
                userLanguage: localStorage.getItem("preferredLanguage") || "en",
                pageVariant: "booking_form_component",
                promo_code: PROMO_CODE,

                first_name: data["first-name"],
                last_name: data["last-name"],
                carYear: data["vehicle-year"],
                carMake: data["vehicle-make"],
                carModel: data["vehicle-model"],
                symptom: data["service_type"],
                comments: data["user_comments"] || "",
            };

            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(webhookData),
                });
                if (response.ok) {
                    const responseData = await response.json();
                    if (responseData?.audioUrl)
                        sessionStorage.setItem(
                            "customAudioUrl",
                            responseData.audioUrl,
                        );
                    if (responseData?.couponCode)
                        sessionStorage.setItem(
                            "userCouponCode",
                            responseData.couponCode,
                        );
                }
            } catch (error) {
                console.error("Webhook Fetch Error:", error);
            } finally {
                const thankYouFullUrl = new URL(
                    window.location.origin +
                        THANK_YOU_URL +
                        window.location.search,
                );
                for (const key in webhookData) {
                    if (webhookData[key])
                        thankYouFullUrl.searchParams.append(
                            key,
                            webhookData[key].toString(),
                        );
                }
                window.location.href = thankYouFullUrl.toString();
            }
        });

        renderCalendar();
        checkStep1Completion();
        checkStep2Completion();
        checkStep3Completion();
    })();
</script>
