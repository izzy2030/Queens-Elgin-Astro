---
// src/components/ServicesHome.astro
// Refactored for Queens Auto Services Elgin (the shop)
import type { BrandConfig } from "../brands";
import { mobileTiresBrand } from "../brands";
import CtaButtonSecondary from "./CtaButtonSecondary.astro";

const { brand = mobileTiresBrand } = Astro.props as { brand?: BrandConfig };
---

<section class="py-24 relative overflow-hidden">
  <div
    class="absolute -left-20 top-40 w-64 h-64 bg-queens-secondary/5 rounded-full blur-3xl pointer-events-none"
  >
  </div>

  <div class="site-canvas">
    {/* HEADER: Focus on Full-Service Auto Shop */}
    <div class="text-center max-w-4xl mx-auto mb-16">
      <div
        class="inline-flex items-center gap-2.5 px-4 py-1.5 rounded-full bg-queens-secondary-ultra-light dark:bg-queens-secondary-darker border border-queens-secondary-light dark:border-queens-secondary-dark text-queens-secondary-darker dark:text-queens-secondary-ultra-light text-[10px] sm:text-xs font-bold uppercase tracking-[0.2em] mb-8"
      >
        <span class="relative flex h-2 w-2">
          <span
            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-queens-secondary dark:bg-queens-secondary-ultra-light opacity-75"
          ></span>
          <span
            class="relative inline-flex rounded-full h-2 w-2 bg-queens-secondary dark:bg-queens-secondary-ultra-light"
          ></span>
        </span>
        Full Service Auto Shop
      </div>
      <h2 class="display-xl text-queens-primary dark:text-white mb-8">
        Expert Auto Care. <br />
        <span class="text-queens-secondary">Right Here in Elgin.</span>
      </h2>
      <p class="text-lg text-gray-600 dark:text-gray-400 leading-relaxed">
        Queens Auto Services has been the trusted auto repair shop in Elgin, IL
        for over a decade. From oil changes to complete engine overhauls, our
        experienced technicians handle it all.
      </p>
    </div>

    {/* BENTO GRID */}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {/* CARD 1: COMPLETE AUTO REPAIR */}
      <div
        class="md:col-span-2 rounded-3xl p-8 shadow-2xl hover:shadow-queens-secondary/20 transition duration-500 group relative overflow-hidden border border-gray-800"
        style="background: linear-gradient(135deg, #0D1B2A 0%, #0D1B2A 60%, #132F4C 100%);"
      >
        <div class="relative z-10">
          <div
            class="w-14 h-14 bg-gray-800 rounded-2xl flex items-center justify-center mb-6 text-queens-secondary group-hover:scale-110 transition duration-500"
          >
            {/* WRENCH ICON */}
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-7 h-7"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21.75 6.75a4.5 4.5 0 01-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 11-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 016.336-4.486l-3.276 3.276a3.004 3.004 0 002.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852z"
              ></path>
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-white mb-3">
            Complete Auto Repair
          </h3>
          <p class="text-gray-400 mb-6 max-w-md">
            From routine maintenance to major repairs, our state-of-the-art
            facility and experienced technicians can handle any make or model.
            We stand behind our work with a 24-month warranty.
          </p>
          <div class="flex flex-wrap gap-2">
            <span
              class="px-3 py-1 bg-gray-800 rounded-lg text-xs font-bold text-gray-300 border border-gray-700"
              >Engine Repair</span
            >
            <span
              class="px-3 py-1 bg-gray-800 rounded-lg text-xs font-bold text-gray-300 border border-gray-700"
              >Transmission</span
            >
            <span
              class="px-3 py-1 bg-gray-800 rounded-lg text-xs font-bold text-gray-300 border border-gray-700"
              >Suspension</span
            >
            <span
              class="px-3 py-1 bg-gray-800 rounded-lg text-xs font-bold text-gray-300 border border-gray-700"
              >Electrical</span
            >
          </div>
        </div>
      </div>

      {/* CARD 2: BRAKE SERVICE */}
      <div
        class="bg-gray-50 dark:bg-white/5 border border-gray-100 dark:border-white/10 rounded-3xl p-8 shadow-lg hover:shadow-2xl dark:shadow-queens-secondary/5 dark:hover:shadow-queens-secondary/20 transition duration-500 group"
      >
        <div
          class="w-14 h-14 bg-queens-primary rounded-2xl flex items-center justify-center mb-6 text-white group-hover:bg-queens-secondary transition duration-300"
        >
          {/* STOP ICON */}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-7 h-7"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 9.563C9 9.252 9.252 9 9.563 9h4.874c.311 0 .563.252.563.563v4.874c0 .311-.252.563-.563.563H9.564A.562.562 0 019 14.437V9.564z"
            ></path>
          </svg>
        </div>
        <h3 class="text-xl font-bold text-queens-primary dark:text-white mb-2">
          Brake Service
        </h3>
        <p class="text-gray-500 dark:text-gray-400 text-sm leading-relaxed">
          Pads, rotors, calipers, and brake fluid service. We inspect your
          entire braking system and ensure your safety on the road.
        </p>
      </div>

      {/* CARD 3: OIL CHANGE */}
      <div
        class="bg-gray-50 dark:bg-white/5 border border-gray-100 dark:border-white/10 rounded-3xl p-8 shadow-lg hover:shadow-2xl dark:shadow-queens-secondary/5 dark:hover:shadow-queens-secondary/20 transition duration-500 group"
      >
        <div
          class="w-14 h-14 bg-queens-primary rounded-2xl flex items-center justify-center mb-6 text-white group-hover:bg-queens-secondary transition duration-300"
        >
          {/* DROP ICON */}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-7 h-7"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"
            ></path>
          </svg>
        </div>
        <h3 class="text-xl font-bold text-queens-primary dark:text-white mb-2">
          Oil Changes
        </h3>
        <p class="text-gray-500 dark:text-gray-400 text-sm leading-relaxed">
          Conventional, synthetic blend, or full synthetic. Quick service with a
          multi-point inspection included on every visit.
        </p>
      </div>

      {/* CARD 4: TIRE SHOP */}
      <div
        class="md:col-span-2 bg-gray-50 dark:bg-white/5 border border-gray-100 dark:border-white/10 rounded-3xl p-8 shadow-lg hover:shadow-2xl dark:shadow-queens-secondary/5 dark:hover:shadow-queens-secondary/20 transition duration-500 flex flex-col md:flex-row items-end gap-8 group"
      >
        <div class="flex-grow">
          <div
            class="w-14 h-14 bg-queens-primary rounded-2xl flex items-center justify-center mb-6 text-white group-hover:bg-queens-secondary transition duration-300"
          >
            {/* TIRE/WHEEL ICON */}
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-7 h-7"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 9.563C9 9.252 9.252 9 9.563 9h4.874c.311 0 .563.252.563.563v4.874c0 .311-.252.563-.563.563H9.564A.562.562 0 019 14.437V9.564z"
              ></path>
            </svg>
          </div>
          <h3
            class="text-2xl font-bold text-queens-primary dark:text-white mb-3"
          >
            Full Tire Shop
          </h3>
          <p class="text-gray-500 dark:text-gray-400">
            We carry all major brands: Michelin, Goodyear, Continental, and
            more. Professional mounting, balancing, and TPMS service included.
            Competitive prices with expert installation.
          </p>
        </div>
        <div class="flex-shrink-0">
          <CtaButtonSecondary href="/services" text="View All Services" />
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  let servicesHomeCtx: gsap.Context | null = null;

  function initServicesHomeAnimations() {
    // Clean up previous animations
    if (servicesHomeCtx) {
      servicesHomeCtx.revert();
      servicesHomeCtx = null;
    }

    // Find the section by looking for the unique heading text
    const allSections = document.querySelectorAll("section");
    let section: Element | null = null;

    allSections.forEach((sec) => {
      if (
        sec.textContent?.includes("Expert Auto Care") &&
        sec.textContent?.includes("Right Here in Elgin")
      ) {
        section = sec;
      }
    });

    if (!section) return;

    // Create scoped context
    servicesHomeCtx = gsap.context(() => {
      // Header elements
      const headerContainer = section!.querySelector(".text-center");
      const badge = headerContainer?.querySelector(".inline-flex");
      const headline = headerContainer?.querySelector("h2");
      const description = headerContainer?.querySelector("p");

      // Bento grid cards
      const cards = section!.querySelectorAll(".grid > div");

      // Animate header elements
      const headerElements = [badge, headline, description].filter(Boolean);

      if (headerElements.length > 0) {
        gsap.fromTo(
          headerElements,
          { y: -40, opacity: 0 },
          {
            y: 0,
            opacity: 1,
            stagger: 0.15,
            duration: 0.8,
            ease: "power2.out",
            scrollTrigger: {
              trigger: section,
              start: "top 50%",
              once: true,
            },
          },
        );
      }

      // Animate bento grid cards with stagger
      if (cards.length > 0) {
        gsap.fromTo(
          cards,
          { y: 60, opacity: 0, scale: 0.95 },
          {
            y: 0,
            opacity: 1,
            scale: 1,
            stagger: 0.12,
            duration: 0.8,
            ease: "power2.out",
            scrollTrigger: {
              trigger: section,
              start: "top 40%",
              once: true,
            },
          },
        );
      }
    }, section);
  }

  // Initialize after page load
  document.addEventListener("astro:page-load", () => {
    requestAnimationFrame(() => {
      setTimeout(initServicesHomeAnimations, 200);
    });
  });

  // Cleanup before page swap (Astro View Transitions)
  document.addEventListener("astro:before-swap", () => {
    if (servicesHomeCtx) {
      servicesHomeCtx.revert();
      servicesHomeCtx = null;
    }
  });
</script>
